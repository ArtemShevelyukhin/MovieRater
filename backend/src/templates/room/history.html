{% extends "base.html" %}

{% block title %}История — {{ room_id }}{% endblock %}

{% block head_styles %}
{{ super() }}
<style>
    .sort-container {
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .sort-select {
        background: var(--surface);
        color: var(--text);
        border: 1px solid var(--border);
        padding: 5px 10px;
        border-radius: 4px;
    }
    .history-list {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    .history-item {
        display: flex;
        gap: 15px;
        background: var(--surface);
        padding: 10px;
        border-radius: 8px;
    }
    .history-item img {
        width: 60px;
        height: 90px;
        object-fit: cover;
        border-radius: 4px;
    }
</style>
{% endblock %}

{% block content %}
<div class="sort-container">
    <span>Сортировать:</span>
    <select id="sort-select" class="sort-select" onchange="applySort()">
        <option value="date_desc" {% if current_sort == 'date_desc' %}selected{% endif %}>Сначала новые</option>
        <option value="date_asc" {% if current_sort == 'date_asc' %}selected{% endif %}>Сначала старые</option>
        <option value="title" {% if current_sort == 'title' %}selected{% endif %}>По названию (А-Я)</option>
    </select>
</div>

<div class="history-list">
    {% for entry in history %}
    <div class="history-item">
        <img src="{{ entry.movie.poster_preview_url or entry.movie.poster_url }}" alt="poster">
        <div>
            <div style="font-weight: bold;">{{ entry.movie.title }}</div>
            <div style="font-size: 0.8rem; color: var(--text-secondary);">
                Добавлен: {{ entry.added_date.strftime('%d.%m.%Y') }}
            </div>
        </div>
    </div>
    {% else %}
    <p>История пуста</p>
    {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script>
function applySort() {
    const sortValue = document.getElementById('sort-select').value;
    const currentUrl = new URL(window.location.href);

    // Устанавливаем новый параметр сортировки
    currentUrl.searchParams.set('sort', sortValue);

    // Перенаправляем пользователя
    window.location.href = currentUrl.toString();
}
</script>
{% endblock %}